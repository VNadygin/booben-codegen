{"version":3,"sources":["../lib/walkJssyValue.js"],"names":["_","require","Path","formatDesignedComponentName","normalizeComponents","parseComponentName","FileTypes","generateJssyValueAST","visitStaticValue","jssyValue","model","file","path","value","sourceData","isArray","forEach","itemValue","index","walkJssyValue","extend","type","StepTypes","ARRAY_INDEX","isObject","forOwn","key","OBJECT_KEY","visitDataValue","calcArgsModel","queryArgs","schema","args","Object","keys","name","push","types","Query","fields","findListGraphQL","values","designerComponent","component","props","findDeep","prop","source","children","usingGraphQL","rootField","queryPath","field","queryField","nestedValuesArray","nestedArsArray","componentId","_steps","filter","item","components","nested","reduceRight","prev","current","nestedValues","nestedArgs","previousValues","queries","get","previousArgs","newValues","slice","set","addActionsForHandler","actions","serializedPath","serialize","handlers","has","visitStateValue","stateSlot","componentNamespace","namespace","componentName","componentMeta","meta","activeStateSlots","Set","add","propMeta","propName","sourceConfigs","updateState","handlerPath","COMPONENT_ID","SWITCH","COMPONENT_PROP_NAME","params","visitAction","action","refs","argValue","METHOD_ARG","fileKey","paramsKey","systemPropName","routeParams","paramValue","paramName","ROUTE_PARAM_NAME","mutationName","mutation","project","auth","loginMutation","mutationReturnType","Mutation","returnFields","mutations","map","nonNull","argName","MUTATION_ARG","param","url","body","importHelpers","helpers","openUrl","successActions","visitActionsList","errorActions","ACTION_INDEX","visitActionsValue","visitFunctionArgsList","FUNCTION_ARG","visitFunctionValue","funcName","function","functionSource","importProjectFunctions","importBuiltinFunctions","visitRouteParamsValue","needRouteParams","visitDesignerValue","emitFile","fileName","DESIGNED_COMPONENT","Error","module","exports"],"mappings":"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","file":"walkJssyValue.js","sourcesContent":["'use strict';\n\nconst _ = require('lodash');\nconst Path = require('./Path');\nconst { formatDesignedComponentName } = require('./names');\nconst { normalizeComponents, parseComponentName } = require('./misc');\nconst { FileTypes } = require('./constants');\nconst generateJssyValueAST = require('./generateJssyValueAST');\n\nconst visitStaticValue = (jssyValue, model, file, path) => {\n  const value = jssyValue.sourceData.value;\n\n  if (_.isArray(value)) {\n    value.forEach((itemValue, index) => {\n      walkJssyValue(\n        itemValue,\n        model,\n        file,\n        path.extend({ type: Path.StepTypes.ARRAY_INDEX, value: index })\n      );\n    });\n  } else if (_.isObject(value)) {\n    _.forOwn(value, (itemValue, key) => {\n      walkJssyValue(\n        itemValue,\n        model,\n        file,\n        path.extend({ type: Path.StepTypes.OBJECT_KEY, value: key })\n      );\n    });\n  }\n};\n\nconst visitDataValue = (jssyValue, model, file, path) => {\n  const calcArgsModel = (queryArgs, schema) => {\n    const args = [];\n    Object.keys(queryArgs).forEach(type => {\n      Object.keys(queryArgs[type]).forEach(name => {\n        walkJssyValue(queryArgs[type][name], model, file, path);\n\n        args.push({\n          name,\n          type: schema.types.Query.fields[type].args[name].type,\n          value: generateJssyValueAST(queryArgs[type][name]),\n        });\n      });\n    });\n    return args;\n  };\n  const findListGraphQL = component => {\n    const values = [];\n\n    const designerComponent = component.props.component.sourceData.component;\n    const findDeep = component => {\n      Object.keys(component.props).forEach(prop => {\n        if (component.props[prop].source === 'data') {\n          values.push(component.props[prop].sourceData);\n        }\n      });\n      component.children.forEach(findDeep);\n    };\n    findDeep(designerComponent);\n    return values;\n  };\n\n  file.usingGraphQL = true;\n  const rootField = jssyValue.sourceData.queryPath[0].field;\n  const queryField = model.schema.types.Query.fields[rootField];\n  if (queryField) {\n    let nestedValuesArray = [];\n    let nestedArsArray = [];\n    //TODO: fix Path Class\n    const componentId = path._steps.filter(item => item.type === 1)[0].value;\n\n    if (file.components[componentId].name === 'List') {\n      const nested = findListGraphQL(file.components[componentId]);\n      nested.forEach(item => {\n        nestedValuesArray.push(\n          item.queryPath.reduceRight((prev, current) => {\n            return {\n              [current.field]: prev,\n            };\n          }, {})\n        );\n        nestedArsArray.push(calcArgsModel(item.queryArgs, model.schema));\n      });\n    }\n    let nestedValues = {};\n    let nestedArgs = [];\n\n    nestedValuesArray.forEach(\n      item => (nestedValues = { ...nestedValues, ...item })\n    );\n\n    nestedArsArray.forEach(item => (nestedArgs = [...nestedArgs, ...item]));\n\n    const previousValues =\n      file.queries.get(queryField.name) &&\n      file.queries.get(queryField.name).values;\n\n    const previousArgs =\n      (file.queries.get(queryField.name) &&\n        file.queries.get(queryField.name).args) ||\n      [];\n\n    const newValues = jssyValue.sourceData.queryPath\n      .slice(1)\n      .reduceRight((prev, current) => {\n        return {\n          [current.field]: prev,\n        };\n      }, {});\n\n    file.queries.set(queryField.name, {\n      values: {\n        ...previousValues,\n        ...newValues,\n        ...nestedValues,\n      },\n      args: [...previousArgs],\n    });\n\n    const args = calcArgsModel(jssyValue.sourceData.queryArgs, model.schema);\n\n    if (jssyValue.sourceData.queryArgs[queryField.name]) {\n      file.queries.set(queryField.name, {\n        values: {\n          ...file.queries.get(queryField.name).values,\n        },\n        args: [...previousArgs, ...args, ...nestedArgs],\n      });\n    }\n  }\n};\n\nconst addActionsForHandler = (file, path, actions) => {\n  const serializedPath = path.serialize();\n\n  if (file.handlers.has(serializedPath)) {\n    file.handlers.get(serializedPath).actions.push(...actions);\n  } else {\n    file.handlers.set(serializedPath, { path, actions });\n  }\n};\n\nconst visitStateValue = (jssyValue, model, file) => {\n  const componentId = jssyValue.sourceData.componentId;\n  const component = file.components[componentId];\n  const stateSlot = jssyValue.sourceData.stateSlot;\n  const {\n    namespace: componentNamespace,\n    name: componentName,\n  } = parseComponentName(component.name);\n\n  const componentMeta =\n    model.meta[componentNamespace].components[componentName];\n\n  if (!file.activeStateSlots.has(componentId)) {\n    file.activeStateSlots.set(componentId, new Set());\n  }\n\n  file.activeStateSlots.get(componentId).add(stateSlot);\n\n  Object.keys(componentMeta.props).forEach(propName => {\n    const propMeta = componentMeta.props[propName];\n\n    if (\n      propMeta.sourceConfigs &&\n      propMeta.sourceConfigs.actions &&\n      propMeta.sourceConfigs.actions.updateState &&\n      propMeta.sourceConfigs.actions.updateState[stateSlot]\n    ) {\n      const handlerPath = new Path([\n        { type: Path.StepTypes.COMPONENT_ID, value: componentId },\n        { type: Path.StepTypes.SWITCH, value: 'props' },\n        { type: Path.StepTypes.COMPONENT_PROP_NAME, value: propName },\n      ]);\n\n      const value = propMeta.sourceConfigs.actions.updateState[stateSlot];\n\n      addActionsForHandler(file, handlerPath, [\n        {\n          type: 'setState',\n          params: { componentId, stateSlot, value },\n        },\n      ]);\n    }\n  });\n};\n\nconst visitAction = (action, model, file, path) => {\n  if (action.type === 'method') {\n    file.refs.add(action.params.componentId);\n\n    action.params.args.forEach((argValue, index) => {\n      walkJssyValue(\n        argValue,\n        model,\n        file,\n        path.extend([\n          { type: Path.StepTypes.SWITCH, value: 'args' },\n          { type: Path.StepTypes.METHOD_ARG, value: index },\n        ])\n      );\n    });\n  } else if (action.type === 'prop') {\n    let fileKey;\n    let paramsKey;\n\n    if (action.params.systemPropName) {\n      fileKey = 'systemPropsState';\n      paramsKey = 'systemPropName';\n    } else {\n      fileKey = 'propsState';\n      paramsKey = 'propName';\n    }\n\n    if (!file[fileKey].has(action.params.componentId)) {\n      file[fileKey].set(action.params.componentId, new Set());\n    }\n\n    file[fileKey].get(action.params.componentId).add(action.params[paramsKey]);\n\n    walkJssyValue(\n      action.params.value,\n      model,\n      file,\n      path.extend({ type: Path.StepTypes.SWITCH, value: 'value' })\n    );\n  } else if (action.type === 'navigate') {\n    _.forOwn(action.params.routeParams, (paramValue, paramName) => {\n      walkJssyValue(\n        paramValue,\n        model,\n        file,\n        path.extend([\n          { type: Path.StepTypes.SWITCH, value: 'routeParams' },\n          { type: Path.StepTypes.ROUTE_PARAM_NAME, value: paramName },\n        ])\n      );\n    });\n  } else if (action.type === 'mutation') {\n    file.usingGraphQL = true;\n    const mutationName = action.params.mutation;\n\n    if (model.project.auth.loginMutation === mutationName) {\n      file.auth = model.project.auth;\n    }\n\n    const mutationReturnType =\n      model.schema.types.Mutation.fields[mutationName].type;\n    const returnFields = Object.keys(\n      model.schema.types[mutationReturnType].fields\n    );\n    const values = returnFields[0];\n    //TODO: this can be done better\n    file.mutations.set(mutationName, {\n      args: Object.keys(action.params.args).map(item => {\n        return {\n          name: item,\n          type: !model.schema.types.Mutation.fields[mutationName].args[item]\n            .nonNull\n            ? model.schema.types.Mutation.fields[mutationName].args[item].type\n            : `${\n                model.schema.types.Mutation.fields[mutationName].args[item].type\n              }!`,\n        };\n      }),\n      values,\n    });\n\n    _.forOwn(action.params.args, (argValue, argName) => {\n      walkJssyValue(\n        argValue,\n        model,\n        file,\n        path.extend([\n          { type: Path.StepTypes.SWITCH, value: 'args' },\n          { type: Path.StepTypes.MUTATION_ARG, value: argName },\n        ])\n      );\n    });\n  } else if (action.type === 'ajax') {\n    walkJssyValue(\n      action.param.url,\n      model,\n      file,\n      path.extend({ type: Path.StepTypes.SWITCH, value: 'url' })\n    );\n\n    walkJssyValue(\n      action.param.body,\n      model,\n      file,\n      path.extend({ type: Path.StepTypes.SWITCH, value: 'body' })\n    );\n  } else if (action.type === 'url') {\n    file.importHelpers.add('openUrl');\n\n    if (!model.helpers.openUrl) {\n      model.helpers.openUrl = true;\n    }\n  }\n\n  if (action.params.successActions) {\n    visitActionsList(\n      action.params.successActions,\n      model,\n      file,\n      path.extend({ type: Path.StepTypes.SWITCH, value: 'successActions' })\n    );\n  }\n\n  if (action.params.errorActions) {\n    visitActionsList(\n      action.params.errorActions,\n      model,\n      file,\n      path.extend({ type: Path.StepTypes.SWITCH, value: 'errorActions' })\n    );\n  }\n};\n\nconst visitActionsList = (actions, model, file, path) => {\n  actions.forEach((action, index) => {\n    visitAction(\n      action,\n      model,\n      file,\n      path.extend({ type: Path.StepTypes.ACTION_INDEX, value: index })\n    );\n  });\n};\n\nconst visitActionsValue = (jssyValue, model, file, path) => {\n  addActionsForHandler(file, path, jssyValue.sourceData.actions);\n\n  visitActionsList(\n    jssyValue.sourceData.actions,\n    model,\n    file,\n    path.extend({ type: Path.StepTypes.SWITCH, value: 'actions' })\n  );\n};\n\nconst visitFunctionArgsList = (args, model, file, path) => {\n  args.forEach((argValue, index) => {\n    walkJssyValue(\n      argValue,\n      model,\n      file,\n      path.extend({ type: Path.StepTypes.FUNCTION_ARG, value: index })\n    );\n  });\n};\n\nconst visitFunctionValue = (jssyValue, model, file, path) => {\n  const funcName = jssyValue.sourceData.function;\n\n  if (jssyValue.sourceData.functionSource === 'project') {\n    file.importProjectFunctions.add(funcName);\n  } else {\n    file.importBuiltinFunctions.add(funcName);\n  }\n\n  visitFunctionArgsList(\n    jssyValue.sourceData.args,\n    model,\n    file,\n    path.extend({ type: Path.StepTypes.SWITCH, value: 'args' })\n  );\n};\n\nconst visitRouteParamsValue = file => {\n  file.needRouteParams = true;\n};\n\nconst visitDesignerValue = (jssyValue, path, emitFile) => {\n  const fileName = formatDesignedComponentName(path);\n  const components = normalizeComponents(jssyValue.sourceData.component);\n  emitFile(fileName, FileTypes.DESIGNED_COMPONENT, components, 0);\n};\n\nconst walkJssyValue = (jssyValue, model, file, path, emitFile) => {\n  switch (jssyValue.source) {\n    case 'static':\n      visitStaticValue(jssyValue, model, file, path);\n      break;\n    case 'const':\n      break;\n    case 'data':\n      visitDataValue(jssyValue, model, file, path);\n      break;\n    case 'actions':\n      visitActionsValue(jssyValue, model, file, path);\n      break;\n    case 'routeParams':\n      visitRouteParamsValue(file);\n      break;\n    case 'state':\n      visitStateValue(jssyValue, model, file);\n      break;\n    case 'function':\n      visitFunctionValue(jssyValue, model, file, path);\n      break;\n    case 'designer':\n      visitDesignerValue(jssyValue, path, emitFile);\n      break;\n    case 'ownerProp':\n      break;\n    case 'actionArg':\n      break;\n    default:\n      throw new Error(`Got JssyValue with unknown source: ${jssyValue.source}`);\n  }\n};\n\nmodule.exports = walkJssyValue;\n"]}